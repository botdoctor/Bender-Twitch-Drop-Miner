FROM python:3.12-slim

WORKDIR /usr/src/app

# Copy requirements and install Python dependencies only
COPY ./requirements.txt ./
RUN pip install --upgrade pip && pip install -r requirements.txt

# Copy application files
COPY ./TwitchChannelPointsMiner ./TwitchChannelPointsMiner
COPY ./run.py ./run.py
COPY ./login.py ./login.py
COPY ./pass.txt ./pass.txt
COPY ./ruststreamers.txt ./ruststreamers.txt

# Set test environment variables
ENV TWITCH_USERNAME=treaclefamousn6g
ENV STREAMER_FILE=ruststreamers.txt

# Test run.py but exit before actual mining
ENTRYPOINT ["python", "-c", "import sys; sys.path.append('.'); from run import *; print('âœ“ Run.py loaded successfully!'); print(f'Username: {username}'); print(f'Streamer file: {streamer_file}'); print(f'Found {len(streamer_usernames)} streamers'); print('Docker test complete - would start mining here')"]